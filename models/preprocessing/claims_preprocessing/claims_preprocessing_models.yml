
version: 2

models:

  - name: claims_preprocessing__encounter_grouper
    description: Add all relevant encounter data to medical_claim_table
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      alias: encounter_grouper
      tags: claims_preprocessing
      materialized: table


  - name: claims_preprocessing__service_categories
    description: Assigns service categories to claim lines
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      alias: service_categories
      tags: claims_preprocessing
      materialized: table


  ### Intermediate

  - name: claims_preprocessing__acute_inpatient_institutional_claims
    description: All acute inpatient institutional claim_ids with header values and data quality flags
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      alias: _int_acute_inpatient_institutional_claims
      tags: claims_preprocessing
      materialized: table


  - name: claims_preprocessing__acute_inpatient_data_quality_summary
    description: Summary of data quality issues with acute inpatient claims
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      alias: _int_acute_inpatient_data_quality_summary
      tags: claims_preprocessing
      materialized: table


  - name: claims_preprocessing__acute_inpatient_institutional_encounter_id
    description: Assigns encounter_id to every acute inpatient institutional claim
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      alias: _int_acute_inpatient_institutional_encounter_id
      tags: claims_preprocessing


  - name: claims_preprocessing__acute_inpatient_encounter_start_and_end_dates
    description: Defines encounter start and end dates for acute inpatient encounters
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      alias: _int_acute_inpatient_encounter_start_and_end_dates
      tags: claims_preprocessing
      materialized: table


  - name: claims_preprocessing__acute_inpatient_professional_encounter_id
    description: Assigns encounter_id to every acute inpatient professional claim
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      alias: _int_acute_inpatient_professional_encounter_id
      tags: claims_preprocessing
      materialized: table


  - name: claims_preprocessing__acute_inpatient_encounter_id
    description: Fix encounter_id so each professional claim can only belong to one encounter
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      alias: _int_acute_inpatient_encounter_id
      tags: claims_preprocessing
      materialized: view


  - name: claims_preprocessing__acute_inpatient_claims_with_encounter_data
    description: Add all relevant encounter data to each acute inpatient claim_id
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      alias: _int_acute_inpatient_claims_with_encounter_data
      tags: claims_preprocessing
      materialized: table


  - name: claims_preprocessing__encounter_data_for_medical_claims
    description: All encounter-related fields that will be added to medical_claim
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      alias: _int_encounter_data_for_medical_claims
      tags: claims_preprocessing
      materialized: view
