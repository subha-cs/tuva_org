version: 2

models:
## Staging
  - name: quality_measures_reporting__stg_core__condition
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures_reporting{% else %}quality_measures_reporting{%- endif -%}
      alias: _stg_condition
      tags: quality_measures_reporting
      materialized: ephemeral
    description: Staging conditions from core.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
        tests:
          - not_null:
              severity: warn
      - name: condition_date
        description: Date in which the condition occured.
      - name: code_type
        description: The type of condition code.
      - name: code
        description: The condition code.
      - name: last_update
        description: The date and timestamp of the dbt run.

  - name: quality_measures_reporting__stg_core__patient
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures_reporting{% else %}quality_measures_reporting{%- endif -%}
      alias: _stg_patient
      tags: quality_measures_reporting
      materialized: ephemeral
    description: Staging eligibility from the input layer.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
        tests:
          - not_null:
              severity: warn
      - name: gender
        description: Biological sex of the patient.
        tests:
          - not_null:
              severity: warn
          - accepted_values:
              values: ['female', 'male']
              severity: warn
      - name: birth_date
        description: Date the patient was born.
        tests:
          - not_null:
              severity: warn
      - name: death_date
        description: The death date of the patient if there is one.
      - name: last_update
        description: The date and timestamp of the dbt run.

  - name: quality_measures_reporting__stg_core__procedure
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures_reporting{% else %}quality_measures_reporting{%- endif -%}
      alias: _stg_procedure
      tags: quality_measures_reporting
      materialized: ephemeral
    description: Staging procedures from core.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
        tests:
          - not_null:
              severity: warn
      - name: procedure_date
        description: Date when the procedure was performed.
      - name: code_type
        description: The type of condition code.
      - name: code
        description: The condition code.
      - name: last_update
        description: The date and timestamp of the dbt run.

  - name: quality_measures_reporting__stg_medical_claim
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures_reporting{% else %}quality_measures_reporting{%- endif -%}
      alias: _stg_medical_claim
      tags: quality_measures_reporting
      materialized: ephemeral
    description: Staging medical claims from the input layer.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: claim_start_date
        description: Start date for the claim.
      - name: claim_end_date
        description: End date for the claim.
      - name: place_of_service
        description: Place of service for the claim (professional claims only).
      - name: hcpcs_code
        description: HCPCS level 1 or level 2 code for the claim line.
      - name: last_update
        description: The date and timestamp of the dbt run.


  - name: quality_measures_reporting__stg_pharmacy_claim
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures_reporting{% else %}quality_measures_reporting{%- endif -%}
      alias: _stg_pharmacy_claim
      tags: quality_measures_reporting
      materialized: ephemeral
    description: Staging pharmacy claims from the input layer.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: dispensing_date
        description: Date the prescription was filled.
      - name: ndc_code
        description: National drug code on the claim.
      - name: paid_date
        description: Date the claim was paid.
      - name: last_update
        description: The date and timestamp of the dbt run.